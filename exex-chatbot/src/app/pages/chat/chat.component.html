<div class="chat-layout">
  <aside class="sidebar">
    <div class="search">
      <i class="pi pi-search"></i>
      <input pInputText type="text" placeholder="Tìm kiếm hội thoại" [(ngModel)]="search" (ngModelChange)="refreshList()"/>
    </div>
    <div class="conv-list">
      <button class="new-btn" pButton type="button" label="Cuộc trò chuyện mới" (click)="activeConversationId=Date.now().toString(); messages=[];"></button>
      <div *ngFor="let c of conversations" class="conv" [class.active]="c.id===activeConversationId" (click)="activeConversationId=c.id">
        <div class="title">{{ c.title }}</div>
        <div class="preview">{{ c.lastMessage }}</div>
      </div>
    </div>
  </aside>
  <main class="main">
    <div class="messages" #scrollContainer>
      <div *ngFor="let m of messages" class="row" [class.me]="m.role==='user'">
        <div class="bubble">
          {{ m.text }}
        </div>
      </div>
      <div *ngIf="isTyping" class="typing">
        <i class="pi pi-spin pi-spinner"></i>
        <span>Bot đang trả lời…</span>
      </div>
    </div>
    <div class="composer">
      <input pInputText [(ngModel)]="inputText" placeholder="Nhập tin nhắn..." (keyup.enter)="send()"/>
      <label class="file-btn">
        <i class="pi pi-paperclip"></i>
        <input type="file" multiple (change)="attachments = Array.from($event.target.files)" hidden>
      </label>
      <button pButton icon="pi pi-send" class="p-button-success" (click)="send()"></button>
    </div>
    <div *ngIf="attachments.length" class="attachments">
      {{ attachments.length }} file được chọn
      <a (click)="attachments=[]" class="clear">Xóa</a>
    </div>
  </main>
</div>
